<div class="row" style="text-align:center; margin-bottom:10px;">
    <div class="input-append">
        <input type="text" id="search-text" name="search" class="span4" placeholder="{{ _('action_add_ester_search_placeholder') }}" value="" /><button id="search-button" class="btn">{{ _('search_button') }}</button>
    </div>
    <img src="{{ static_url('images/spinner_white.gif') }}" id="search-spinner" style="padding:40px; display:none;" />
</div>
<table id="search-results" class="table" style="margin:0px;">
</table>

<script>
    $(document).ready(function(){

        $('#search-text').focus();

        $("#search-text").keyup(function(event) {
            if(event.keyCode == 13){
                $("#search-button").click();
            }
        });

        $('#search-button').click(function() {
            $('#search-spinner').show();
            $('#search-results').hide();
            $('#search-results').html('');
            $.post('/action/ester/search', {
                query: $('#search-text').val()
            },
            function(list) {
                for (i in list.items) {
                    var item = list.items[i];
                    $('#search-results').append('<tr><td style="width:100%;"><b>'+item.title[0]+'</b><br />'+item.publishing_date[0]+'<br /><i>'+item.isbn[0]+'</i></td><td><button class="add-button btn btn-success" data-id="'+item.id+'">{{ _('action_add_ester_add') }}</button></td></tr>');
                };
                $('#search-results').show();
                $('#search-spinner').hide();
            }, 'json');
        });

        $('.add-button').live('click', function() {
            $('#modal-box').modal('hide');
            $('#modal-box').html('');
            $.post('/action/ester/import', {
                ester_id: $(this).data('id'),
                parent_entity_id: '{{ parent_entity_id }}',
                entity_definition_id: '{{ entity_definition_id }}',
            },
            function(new_id) {
                window.location = '/entitygroup-{{ entity_definition_id }}#'+new_id;
            });
        });

    });
</script>
